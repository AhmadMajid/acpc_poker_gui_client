
// @todo move all this to a helper method
// Setup non-display information -------------------

// If a new state is available, display a message to the user and allow the user to update the match state
- if @match_ended
   //- close_dealer!
- elsif @users_turn_to_act
   // Show user actions
   .actions
      %h2 Actions
      //%p= button "Bet", bet_url, view_context.t('.bet')#, :amount_field => true
      %p= button "Call", call_url, 'call', match_id: @match_id, match_slice_index: @match_slice_index
      //%p= button "Check", check_url, view_context.t('.check')
      %p= button "Fold", fold_url, 'fold', match_id: @match_id, match_slice_index: @match_slice_index
      %p= button "Raise", raise_url, 'raise', amount_field: false, match_id: @match_id, match_slice_index: @match_slice_index
- else
   .new_state_available
      %h2 New state available
      // Hidden form to allow AJAX to update the game's state
      // @todo The submit button is actually displayed so this function may not have the best name
      = hidden_update_state_form @match_id, @match_slice_index
   - if @hand_ended
      // Check if the state can be updated
      = hidden_check_for_new_match_state_form @match_id, @match_slice_index   
      :javascript
         setTimeout("check_for_new_match_state()", 100);
         // @todo Move this out of the view into a javascript helper file?
         function check_for_new_match_state() {
            $('.check_for_new_match_state_button').submit();
         };
   - else
      :javascript
         setTimeout("update_game_state()", 100);
         // @todo Move this out of the view into a javascript helper file?
         function update_game_state() {
            $('.update_match_state_button').submit();
         };

// Update the game state if it's not the user's turn to act and the match hasn't ended


// Display elements -----------------------
//%h1= title
%hr

// Show game definitions
//%p= label :post, 'Game Definitions:'
//%p= text_area :game_definition, :to_s

// Show the match states from the current hand
//%p= label :post, 'Current match state:'
//- @match_states_from_current_hand.each do |match_state|
//   %p= match_state

// Show game state information
%p= label :post, 'Game state information:'
%hr

%p= label :post, "match parameters: #{@parameters}"
%p= label :post, "match slice index: #{@match_slice_index}"
%p= label :post, "match state: #{@match_state}"
%p= label :post, "players: #{@players}"
%p= label :post, "User's turn to act?: #{@users_turn_to_act}"
//%p= label :post, "Player with the dealer button: #{@player_with_the_dealer_button.name}" if @player_with_the_dealer_button
//%p= label :post, "Player who posted the big blind: #{@player_who_submitted_big_blind.name}" if @player_who_submitted_big_blind
//%p= label :post, "Player who posted the small blind: #{@player_who_submitted_small_blind.name}" if @player_who_submitted_small_blind
//%p= label :post, "Player whose turn is next: #{@player_whose_turn_is_next.name}" if @player_whose_turn_is_next
//%p= label :post, "Player who acted last: #{@player_who_acted_last.name}" if @player_who_acted_last.respond_to? :name
%p= label :post, "Pot size: #{@pot_size}"
//%p= label :post, "Stack sizes: #{@stack_sizes}"
//%p= label :post, "User's hole cards: #{@users_hole_cards}"
//%p= label :post, "Opponent's hole cards: #{@list_of_opponents_hole_cards}"
//%p= label :post, "Betting actions: #{@list_of_betting_actions}"
%p= label :post, "Board cards: #{@board_cards}"
//%p= label :post, "Hand number: #{@hand_number}"
//%p= label :post, "Maximum number of hands in this match: #{@max_number_of_hands}"
//%p= label :post, "Match name: #{@match_name}"
//%p= label :post, "User's position: #{@users_position}"
%p= label :post, "Betting actions so far: #{@betting_actions}"
%p= label :post, "Last action: #{@last_action}"
////    Which actions are legal?
////- @legal_actions = game_runner.legal_actions
%p= label :post, "Round: #{@round}"
//%p= label :post, "Active players: #{@active_players.map {|p| p.name}}" if @active_players
//%p= label :post, "Number of players: #{@number_of_players}"
%p= label :post, "Has the hand ended?: #{@hand_ended}"
%p= label :post, "Has the match ended?: #{@match_ended}"
//%p= label :post, "Raise size in this round: #{@raise_size}"
//// TODO Only display the chip balance at the end of a hand
//%p= label :post, "Chip balances for each player: #{@chip_balances}"

// Show meta-actions for the user
%hr
%p= button_to "Leave this game", leave_game_url, :class => 'leave', :id => 'leave', :remote => true, :confirm =>  "Are you sure you want to leave this game?"
